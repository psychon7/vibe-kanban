# Cloudflare Workers Configuration for Vibe Kanban
# See: https://developers.cloudflare.com/workers/configuration/

name = "vibe-kanban-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# ─────────────────────────────────────────────────────────────────────────────
# D1 Database Binding
# ─────────────────────────────────────────────────────────────────────────────
# IMPORTANT: After creating the D1 database with `wrangler d1 create`,
# replace <your-database-id> with the actual database ID returned.
#
# Create database: pnpm run d1:create
# Apply migrations: pnpm run d1:migrate (local) or pnpm run d1:migrate:prod (production)

[[d1_databases]]
binding = "DB"
database_name = "vibe-kanban-db"
database_id = "<your-database-id>"
migrations_dir = "migrations"

# ─────────────────────────────────────────────────────────────────────────────
# R2 Storage Binding (for avatars, exports, attachments)
# ─────────────────────────────────────────────────────────────────────────────
# IMPORTANT: Create R2 bucket first: wrangler r2 bucket create vibe-kanban-storage

[[r2_buckets]]
binding = "STORAGE"
bucket_name = "vibe-kanban-storage"

# ─────────────────────────────────────────────────────────────────────────────
# KV Namespace Binding (for session cache, rate limiting)
# ─────────────────────────────────────────────────────────────────────────────
# IMPORTANT: Create KV namespace first: wrangler kv:namespace create CACHE

[[kv_namespaces]]
binding = "CACHE"
id = "<your-kv-namespace-id>"

# ─────────────────────────────────────────────────────────────────────────────
# AI Gateway Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Configure AI Gateway in Cloudflare Dashboard first

[ai]
binding = "AI_GATEWAY"

# ─────────────────────────────────────────────────────────────────────────────
# Environment Variables
# ─────────────────────────────────────────────────────────────────────────────
# Non-sensitive configuration values

[vars]
ENVIRONMENT = "development"
LOG_LEVEL = "debug"

# ─────────────────────────────────────────────────────────────────────────────
# Secrets (set via: wrangler secret put <SECRET_NAME>)
# ─────────────────────────────────────────────────────────────────────────────
# Required secrets:
# - OPENAI_API_KEY: For prompt enhancement
# - ANTHROPIC_API_KEY: For Claude integration
# - CF_ACCESS_CLIENT_ID: Cloudflare Access service token (optional)
# - CF_ACCESS_CLIENT_SECRET: Cloudflare Access service token (optional)

# ─────────────────────────────────────────────────────────────────────────────
# Production Environment
# ─────────────────────────────────────────────────────────────────────────────

[env.production]
vars = { ENVIRONMENT = "production", LOG_LEVEL = "info" }

# Override D1 database for production if using a separate database
# [[env.production.d1_databases]]
# binding = "DB"
# database_name = "vibe-kanban-db-prod"
# database_id = "<your-production-database-id>"
# migrations_dir = "migrations"

# ─────────────────────────────────────────────────────────────────────────────
# Development Settings
# ─────────────────────────────────────────────────────────────────────────────

[dev]
port = 8787
local_protocol = "http"

# ─────────────────────────────────────────────────────────────────────────────
# Build Configuration
# ─────────────────────────────────────────────────────────────────────────────

[build]
command = "npm run build"
